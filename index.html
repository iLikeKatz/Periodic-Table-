<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Periodic Table Game with Timer</title>

    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;500;700&family=Roboto:wght@700&display=swap" rel="stylesheet">
  <script src="index_bootstrap.js"></script>
   <link rel="stylesheet" href="mp_hud.css">

    <script type="module" src="firebase_init.js"></script>

    
    <script src="script_all_features.js" defer></script>
    <script src="index_integration.js" defer></script>
    <script src="mp_hud.js" defer></script>
    <script src="progress_watcher.js" defer></script> </head>

<body>
</head>

<body>
<div id="settings-container">
        <button id="settings-btn">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
    </div>


    <div id="menu-container">
        <button id="hamburger-btn">‚ò∞</button>
    </div>

    <div id="sidebar" class="hidden">
        <button id="close-sidebar-btn">&times;</button>
        <div id="profile-container" class="hidden">
            <img id="profile-pic" src="https://via.placeholder.com/80" alt="Profile Picture">
            <h3 id="username-display">Username</h3>
            <button id="edit-profile-btn" class="edit-profile-button">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
            <div id="profile-links" class="profile-links">
                <a class="profile-link" href="leaderboard.html">üèÜ Leaderboard</a>
                <a class="profile-link" href="multiplayer.html">ü§ù Multiplayer</a>
                <a class="profile-link" href="avatar.html">üß© Avatar</a>
            </div>

            <div id="best-times-container">
                <h4>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á)</h4>
                <p><strong>‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> <span id="best-time-all">N/A</span></p>
                <p><strong>8 ‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å:</strong> <span id="best-time-main">N/A</span></p>
            </div>
            <button id="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
        <div id="login-container">
            <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
            <button id="login-btn">Sign in with Google</button>
        </div>
        
    </div>
    


    <div id="selection-screen">
        <h3>&nbsp;</h3>
        <h1 class="instruction" id="ins">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏≤‡∏ï‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Flashcard</h1>
        <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°"</p>
        <div id="controls">
            <button id="select-all-btn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button id="select-main-groups-btn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 8 ‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å</button>
            <button id="custom-groups-btn">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</button>
            <button id="deselect-all-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <div class="checkbox-control">
                <input type="checkbox" id="random-order-checkbox" checked>
                <label class="instruction" for="random-order-checkbox">‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î</label>
            </div>
            <button id="start-game-btn">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        </div>

        <div id="periodic-table-container">
            <div id="periodic-table"></div>
        </div>

        <div id="legend"></div>
    </div>

    <div id="game-screen" class="hidden">
        <h1>Flashcard ‡∏™‡∏∏‡πà‡∏°‡∏ò‡∏≤‡∏ï‡∏∏</h1>
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard">
                <div class="card-face card-front" id="card-front"></div>
                <div class="card-face card-back" id="card-back"></div>
            </div>
        </div>
        <div id="game-controls">
            <button id="flip-card-btn">‡∏û‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
            <button id="next-card-btn">‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚è≠Ô∏è</button>
            <button id="back-to-selection-btn">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏≤‡∏ï‡∏∏</button>
        </div>
    </div>

    <div id="fill-game-screen" class="hidden">
        <h4>&nbsp;</h4>
        <h1 id="topFill">‡πÄ‡∏ï‡∏¥‡∏°‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</h1>
        <p>‡∏•‡∏≤‡∏Å‡∏ò‡∏≤‡∏ï‡∏∏‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ò‡∏≤‡∏ï‡∏∏</p>
        <div id="fill-game-timer-container">
            <h3>‡πÄ‡∏ß‡∏•‡∏≤:</h3>
            <div id="fill-game-timer">00:00</div>
        </div>
        <div id="element-bank-container">
            <h3>‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ß‡∏≤‡∏á:</h3>
            <div id="element-bank"></div>
        </div>
        <div id="fill-periodic-table-container">
            <div id="fill-periodic-table"></div>
        </div>
        <div id="fill-game-controls">
            <button id="check-answers-btn">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
            <button id="fill-back-to-selection-btn">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏≤‡∏ï‡∏∏</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
                <button id="close-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <span>‡∏ò‡∏µ‡∏°</span>
                    <div id="theme-btn-group">
                        <button id="light-mode-btn" class="theme-btn">‡∏™‡∏ß‡πà‡∏≤‡∏á</button>
                        <button id="dark-mode-btn" class="theme-btn">‡∏°‡∏∑‡∏î</button>
                    </div>
                </div>
                <div class="setting-item">
                    <span>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏°</span>
                    <div id="game-mode-group">
                        <label class="radio-label">
                            <input type="radio" name="game-mode" value="symbol-to-name" checked>
                            <span>‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="game-mode" value="name-to-symbol">
                            <span>‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏ ‚Üí ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</span>
                        </label>
                    </div>
                </div>
                <div class="setting-item slider-control">
                    <span>‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏Å‡∏ß‡πâ‡∏≤‡∏á)</span>
                    <div class="slider-container">
                        <input type="range" id="cell-width-slider" min="30" max="80" value="60">
                        <span id="cell-width-value">60px</span>
                    </div>
                </div>
                <div class="setting-item slider-control">
                    <span>‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏™‡∏π‡∏á)</span>
                    <div class="slider-container">
                        <input type="range" id="cell-height-slider" min="30" max="80" value="60">
                        <span id="cell-height-value">60px</span>
                    </div>
                </div>
                <div class="setting-item">
                    <button id="reset-size-btn">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡∏ô‡∏≤‡∏î (Default)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-choice-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏°</h2>
                <button id="close-choice-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="game-choice-buttons">
                <button id="start-flashcard-game-btn">üÉè Flashcard</button>
                <button id="start-fill-game-btn">üìù ‡πÄ‡∏ï‡∏¥‡∏°‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
            </div>
        </div>
    </div>

    <div id="custom-groups-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</h2>
                <button id="close-custom-groups-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <ul id="custom-groups-list">
                    </ul>
                <div id="custom-groups-controls">
                    <button id="create-new-group-btn">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                </div>
            </div>
        </div>
    </div>

    <div id="save-group-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
                <button id="close-save-group-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</p>
                <input type="text" id="new-group-name-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÇ‡∏•‡∏´‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢">
                <button id="save-new-group-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="edit-profile-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h2>
                <button id="close-edit-profile-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                <div class="setting-item profile-edit-item">
                    <label for="new-username-input">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà:</label>
                    <input type="text" id="new-username-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                </div>
                <button id="save-profile-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                <div id="profile-update-feedback"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // Import Auth functions
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        // NEW: Import Firestore functions
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCxsn_W3oVSM0glCeS7YpkWc-5q8LYShZQ",
            authDomain: "periodic-table-database.firebaseapp.com",
            projectId: "periodic-table-database",
            storageBucket: "periodic-table-database.appspot.com",
            messagingSenderId: "958737094126",
            appId: "1:958737094126:web:285f72dad0ace35d70eaff",
            measurementId: "G-MTNV70JMB4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        // NEW: Initialize Firestore
        const db = getFirestore(app);

        // Make auth functions available globally for script.js
        window.firebaseAuth = {
            auth,
            provider,
            signInWithPopup,
            onAuthStateChanged,
            signOut,
            updateProfile
        };

        // NEW: Make Firestore functions available globally for script.js
        window.firebaseDb = {
            db,
            doc,
            getDoc,
            setDoc
        };

    </script>
    
    <script src="script.js"></script>

<script>
(function(){
  function getQuery(){ const u = new URL(location.href); return Object.fromEntries(u.searchParams.entries()); }
  function tryStart(mode){
    try { if (typeof setGameMode==='function') setGameMode(mode); } catch(e){}
    if (typeof startGame==='function') { startGame(); return true; }
    const btn = document.querySelector('#start, #start-btn, .start-btn, button[data-start]');
    if (btn) { btn.click(); return true; }
    return false;
  }
  document.addEventListener('DOMContentLoaded', ()=>{
    const q = getQuery();
    if (q.room && q.mode) {
      if (!document.getElementById('mp-banner')) {
        const bar = document.createElement('div');
        bar.id = 'mp-banner';
        bar.style.cssText = 'position:sticky;top:0;background:#222;color:#fff;padding:8px 12px;z-index:1001;border-bottom:1px solid #333';
        bar.textContent = `Multiplayer room: ${q.room} | mode: ${q.mode}`;
        document.body.prepend(bar);
      }
      // Expose hooks
      window.reportProgress = (p)=>{ try{ if(window.multiplayer) window.multiplayer.updateProgress(q.room, Math.max(0,Math.min(100,Math.round(p)))); }catch(e){} };
      window.reportFinish = (ms)=>{ try{ if(window.multiplayer) window.multiplayer.finishRun(q.room, Math.max(0,Math.round(ms))); }catch(e){} };
      // Aggressive start loop (max 5s)
      let attempts = 0;
      const t = setInterval(()=>{
        attempts++;
        if (tryStart(q.mode)) { clearInterval(t); }
        if (attempts > 16) { clearInterval(t); }
      }, 300);
    }
  });
})();
</script>

  <script src="mp_hud.js">
    
  </script>
  <script>
  (function () {
    const room = new URL(location.href).searchParams.get('room');
    if (!room) return;

    // ‡∏ï‡∏±‡πâ‡∏á selector ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö DOM ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏î‡∏π‡∏Ç‡πâ‡∏≠ 3)
    window.MP_PROBE_CONFIG = {
      totalSelectors: ['#fill-periodic-table .placeholder-element'],
      correctSelectors: ['#fill-periodic-table .correct-placement'],
      throttleMs: 600
    };

    // ‡πÇ‡∏´‡∏•‡∏î HUD + Watcher ‡πÅ‡∏Ñ‡πà‡∏ï‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
    const s1 = document.createElement('script'); s1.src = 'mp_hud.js';
    const s2 = document.createElement('script'); s2.src = 'progress_watcher.js';
    document.body.appendChild(s1);
    document.body.appendChild(s2);
  })();
</script>

  
</body>

</html>